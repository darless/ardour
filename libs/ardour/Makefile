ROOT = ../../
include $(ROOT)/Makefile.base.mk

CPP_FILES += amp.cc 
CPP_FILES += analyser.cc 
CPP_FILES += analysis_graph.cc 
CPP_FILES += async_midi_port.cc 
CPP_FILES += audio_backend.cc 
CPP_FILES += audio_buffer.cc 
CPP_FILES += audio_library.cc 
CPP_FILES += audio_playlist.cc 
CPP_FILES += audio_playlist_importer.cc 
CPP_FILES += audio_playlist_source.cc 
CPP_FILES += audio_port.cc 
CPP_FILES += audio_region_importer.cc 
CPP_FILES += audio_track.cc 
CPP_FILES += audio_track_importer.cc 
CPP_FILES += audioanalyser.cc 
CPP_FILES += audioengine.cc 
CPP_FILES += audiofile_tagger.cc 
CPP_FILES += audiofilesource.cc 
CPP_FILES += audioregion.cc 
CPP_FILES += audiorom.cc 
CPP_FILES += audiosource.cc 
CPP_FILES += auditioner.cc 
CPP_FILES += automatable.cc 
CPP_FILES += automation.cc 
CPP_FILES += automation_control.cc 
CPP_FILES += automation_list.cc 
CPP_FILES += automation_watch.cc 
CPP_FILES += beatbox.cc 
CPP_FILES += broadcast_info.cc 
CPP_FILES += buffer.cc 
CPP_FILES += buffer_manager.cc 
CPP_FILES += buffer_set.cc 
CPP_FILES += bundle.cc 
CPP_FILES += butler.cc 
CPP_FILES += capturing_processor.cc 
CPP_FILES += chan_count.cc 
CPP_FILES += chan_mapping.cc 
CPP_FILES += circular_buffer.cc 
CPP_FILES += clip_library.cc 
CPP_FILES += config_text.cc 
CPP_FILES += control_group.cc 
CPP_FILES += control_protocol_manager.cc 
CPP_FILES += convolver.cc 
CPP_FILES += cycle_timer.cc 
CPP_FILES += data_type.cc 
CPP_FILES += default_click.cc 
CPP_FILES += debug.cc 
CPP_FILES += delayline.cc 
CPP_FILES += delivery.cc 
CPP_FILES += directory_names.cc 
CPP_FILES += disk_io.cc 
CPP_FILES += disk_reader.cc 
CPP_FILES += disk_writer.cc 
CPP_FILES += dsp_filter.cc 
CPP_FILES += ebur128_analysis.cc 
CPP_FILES += element_import_handler.cc 
CPP_FILES += element_importer.cc 
CPP_FILES += engine_slave.cc 
CPP_FILES += enums.cc 
CPP_FILES += event_type_map.cc 
CPP_FILES += export_channel.cc 
CPP_FILES += export_channel_configuration.cc 
CPP_FILES += export_failed.cc 
CPP_FILES += export_filename.cc 
CPP_FILES += export_format_base.cc 
CPP_FILES += export_format_manager.cc 
CPP_FILES += export_format_specification.cc 
CPP_FILES += export_formats.cc 
CPP_FILES += export_graph_builder.cc 
CPP_FILES += export_handler.cc 
CPP_FILES += export_preset.cc 
CPP_FILES += export_profile_manager.cc 
CPP_FILES += export_smf_writer.cc 
CPP_FILES += export_status.cc 
CPP_FILES += export_timespan.cc 
CPP_FILES += ffmpegfileimportable.cc 
CPP_FILES += ffmpegfilesource.cc 
CPP_FILES += file_source.cc 
CPP_FILES += filename_extensions.cc 
CPP_FILES += filesystem_paths.cc 
CPP_FILES += filter.cc 
CPP_FILES += find_session.cc 
CPP_FILES += fixed_delay.cc 
CPP_FILES += fluid_synth.cc 
CPP_FILES += gain_control.cc 
CPP_FILES += globals.cc 
CPP_FILES += graph.cc 
CPP_FILES += graphnode.cc 
CPP_FILES += graph_edges.cc 
CPP_FILES += iec1ppmdsp.cc 
CPP_FILES += iec2ppmdsp.cc 
CPP_FILES += import.cc 
CPP_FILES += import_pt.cc 
CPP_FILES += instrument_info.cc 
CPP_FILES += internal_return.cc 
CPP_FILES += internal_send.cc 
CPP_FILES += interpolation.cc 
CPP_FILES += io.cc 
CPP_FILES += io_plug.cc 
CPP_FILES += io_processor.cc 
CPP_FILES += kmeterdsp.cc 
CPP_FILES += ladspa_plugin.cc 
CPP_FILES += latent.cc 
CPP_FILES += legatize.cc 
CPP_FILES += library.cc 
CPP_FILES += location.cc 
CPP_FILES += location_importer.cc 
CPP_FILES += ltc_file_reader.cc 
CPP_FILES += ltc_slave.cc 
CPP_FILES += lua_api.cc 
CPP_FILES += luaproc.cc 
CPP_FILES += luascripting.cc 
CPP_FILES += meter.cc 
CPP_FILES += midi_automation_list_binder.cc 
CPP_FILES += midi_buffer.cc 
CPP_FILES += midi_channel_filter.cc 
CPP_FILES += midi_clock_slave.cc 
CPP_FILES += midi_model.cc 
CPP_FILES += midi_patch_manager.cc 
CPP_FILES += midi_playlist.cc 
CPP_FILES += midi_port.cc 
CPP_FILES += midi_region.cc 
CPP_FILES += midi_ring_buffer.cc 
CPP_FILES += midi_scene_change.cc 
CPP_FILES += midi_scene_changer.cc 
CPP_FILES += midi_source.cc 
CPP_FILES += midi_state_tracker.cc 
CPP_FILES += midi_stretch.cc 
CPP_FILES += midi_track.cc 
CPP_FILES += midi_ui.cc 
CPP_FILES += mididm.cc 
CPP_FILES += midiport_manager.cc 
CPP_FILES += minibpm.cc 
CPP_FILES += mix.cc 
CPP_FILES += mixer_scene.cc 
CPP_FILES += mode.cc 
CPP_FILES += monitor_control.cc 
CPP_FILES += monitor_port.cc 
CPP_FILES += monitor_processor.cc 
CPP_FILES += monitor_return.cc 
CPP_FILES += mp3fileimportable.cc 
CPP_FILES += mp3filesource.cc 
CPP_FILES += mtc_slave.cc 
CPP_FILES += mtdm.cc 
CPP_FILES += muteable.cc 
CPP_FILES += mute_control.cc 
CPP_FILES += mute_master.cc 
CPP_FILES += onset_detector.cc 
CPP_FILES += operations.cc 
CPP_FILES += pan_controllable.cc 
CPP_FILES += pannable.cc 
CPP_FILES += panner.cc 
CPP_FILES += panner_manager.cc 
CPP_FILES += panner_shell.cc 
CPP_FILES += parameter_descriptor.cc 
CPP_FILES += phase_control.cc 
CPP_FILES += playlist.cc 
CPP_FILES += playlist_factory.cc 
CPP_FILES += playlist_source.cc 
CPP_FILES += plug_insert_base.cc 
CPP_FILES += plugin.cc 
CPP_FILES += plugin_insert.cc 
CPP_FILES += plugin_manager.cc 
CPP_FILES += plugin_scan_result.cc 
CPP_FILES += polarity_processor.cc 
CPP_FILES += port.cc 
CPP_FILES += port_engine_shared.cc 
CPP_FILES += port_insert.cc 
CPP_FILES += port_manager.cc 
CPP_FILES += port_set.cc 
CPP_FILES += presentation_info.cc 
CPP_FILES += process_thread.cc 
CPP_FILES += processor.cc 
CPP_FILES += quantize.cc 
CPP_FILES += rc_configuration.cc 
CPP_FILES += readable.cc 
CPP_FILES += readonly_control.cc 
CPP_FILES += raw_midi_parser.cc 
CPP_FILES += recent_sessions.cc 
CPP_FILES += record_enable_control.cc 
CPP_FILES += record_safe_control.cc 
CPP_FILES += region_factory.cc 
CPP_FILES += resampled_source.cc 
CPP_FILES += region.cc 
CPP_FILES += return.cc 
CPP_FILES += reverse.cc 
CPP_FILES += route.cc 
CPP_FILES += route_group.cc 
CPP_FILES += route_group_member.cc 
CPP_FILES += rb_effect.cc 
CPP_FILES += rt_task.cc 
CPP_FILES += rt_tasklist.cc 
CPP_FILES += scene_change.cc 
CPP_FILES += search_paths.cc 
CPP_FILES += segment_descriptor.cc 
CPP_FILES += selection.cc 
CPP_FILES += send.cc 
CPP_FILES += session.cc 
CPP_FILES += session_bundles.cc 
CPP_FILES += session_butler.cc 
CPP_FILES += session_click.cc 
CPP_FILES += session_command.cc 
CPP_FILES += session_configuration.cc 
CPP_FILES += session_directory.cc 
CPP_FILES += session_events.cc 
CPP_FILES += session_export.cc 
CPP_FILES += session_handle.cc 
CPP_FILES += session_ltc.cc 
CPP_FILES += session_metadata.cc 
CPP_FILES += session_midi.cc 
CPP_FILES += session_object.cc 
CPP_FILES += session_playlists.cc 
CPP_FILES += session_process.cc 
CPP_FILES += session_rtevents.cc 
CPP_FILES += session_state.cc 
CPP_FILES += session_state_utils.cc 
CPP_FILES += session_time.cc 
CPP_FILES += session_transport.cc 
CPP_FILES += sidechain.cc 
CPP_FILES += simple_export.cc 
CPP_FILES += slavable.cc 
CPP_FILES += slavable_automation_control.cc 
CPP_FILES += smf_source.cc 
CPP_FILES += sndfile_helpers.cc 
CPP_FILES += sndfileimportable.cc 
CPP_FILES += sndfilesource.cc 
CPP_FILES += solo_control.cc 
CPP_FILES += solo_isolate_control.cc 
CPP_FILES += solo_mute_release.cc 
CPP_FILES += solo_safe_control.cc 
CPP_FILES += soundcloud_upload.cc 
CPP_FILES += source.cc 
CPP_FILES += source_factory.cc 
CPP_FILES += speakers.cc 
CPP_FILES += srcfilesource.cc 
CPP_FILES += stripable.cc 
CPP_FILES += step_sequencer.cc 
CPP_FILES += strip_silence.cc 
CPP_FILES += system_exec.cc 
CPP_FILES += revision.cc 
CPP_FILES += rt_midibuffer.cc 
CPP_FILES += template_utils.cc 
CPP_FILES += tempo_map_importer.cc 
CPP_FILES += thawlist.cc 
CPP_FILES += thread_buffers.cc 
CPP_FILES += ticker.cc 
CPP_FILES += track.cc 
CPP_FILES += transient_detector.cc 
CPP_FILES += transform.cc 
CPP_FILES += transport_fsm.cc 
CPP_FILES += transport_master.cc 
CPP_FILES += transport_master_manager.cc 
CPP_FILES += transpose.cc 
CPP_FILES += triggerbox.cc 
CPP_FILES += unknown_processor.cc 
CPP_FILES += user_bundle.cc 
CPP_FILES += utils.cc 
CPP_FILES += vca.cc 
CPP_FILES += vca_manager.cc 
CPP_FILES += velocity_control.cc 
CPP_FILES += video_tools_paths.cc 
CPP_FILES += vumeterdsp.cc 
CPP_FILES += worker.cc 
CPP_FILES += zeroconf.cc

COMMON_LIBS += -lpthread
COMMON_FLAGS += $(shell pkg-config --cflags glibmm-2.4 gtkmm-2.4 libxml-2.0 lilv-0 x11)
COMMON_LIBS += $(shell pkg-config --libs glibmm-2.4 gtkmm-2.4 libxml-2.0 lilv-0 x11)

BUILD_C_FLAGS += $(COMMON_FLAGS) $(BASE_PKG_FLAGS) $(BASE_LIB_INC)

WARN_FLAGS += -Wno-deprecated-declarations
CC=g++ $(WARN_FLAGS)
BUILD_DIR = ../../build_test/libs/ardour
OBJS = $(CPP_FILES:%=$(BUILD_DIR)/%.o)

SHARED_ARDOUR = $(BUILD_DIR)/libs/libardour.so
SHARED_LIBS = $(BUILD_DIR)/libs/libtemporal.so

TARGETS = $(SHARED_ARDOUR)

all: $(TARGETS)

$(BUILD_DIR)/%.cc.o: %.cc
	-@mkdir -p "$(shell dirname $(BUILD_DIR)/$<)"
	@echo "\nCompiling $<"
	$(CC) $< $(BUILD_C_FLAGS) -c -o $@

$(SHARED_ARDOUR): $(OBJS)
	@echo "Creating $@"
	$(CC) $(OBJS) -shared -Wl,-soname -o $(SHARED_ARDOUR) $(COMMON_LIBS) $(SHARED_LIBS)